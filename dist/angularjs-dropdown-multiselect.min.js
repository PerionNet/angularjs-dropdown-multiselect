"use strict";var directiveModule=angular.module("angularjs-dropdown-multiselect",[]);directiveModule.directive("ngDropdownMultiselect",["$filter","$document","$compile","$parse","focus","$sessionStorage",function(e,t,o,n,l,s){return{restrict:"AE",scope:{selectedModel:"=",selectedTempModel:"=",options:"=",disabledTooltip:"=",extraSettings:"=",events:"=",disabled:"=",searchFilter:"=?",translationTexts:"=",groupBy:"@",selectedGroup:"@",showModes:"@",api:"=",isCustomDateOpen:"=",open:"=",dependency:"=",index:"=",tooltipNumLimit:"=",disabledItems:"=",list:"=",listItemMaxChar:"=",listMaxNumOfItems:"=",listMsg:"="},template:function(e,t,o){var n=!!t.checkboxes,l=(t.customdate,'<div class="multiselect-parent btn-group dropdown-multiselect" arrow-selector>');l+='<button id="{{elementId}}_btn" type="button"  ng-disabled=disabled class="dropdown-toggle" ng-class="settings.buttonClasses" ng-click="toggleDropdown()">{{getButtonText(true)}}&nbsp;<span class="caret"></span></button>',l+='<ul id="{{elementId}}-multiselect-wrapper" class="dropdown-menu dropdown-menu-form" ng-if="open" ng-style="{height : settings.scrollable ? settings.scrollableHeight : \'auto\' }" style="overflow: scroll; display: block;" ',l+='infinite-scroll="addMoreItems()" ',l+='infinite-scroll-container="getInfiniteScrollContainer()" ',l+='infinite-scroll-distance="1" ',l+='infinite-scroll-immediate-check="false" >',l+='<div ng-if="list && listMsg"  class="list-input-inst">{{listMsg}}</div>',l+='<li ng-if="list" class="dropdown-list-input" xmlns="http://www.w3.org/1999/html"><input id="{{elementId}}_input" ng-keypress="submitListVal($event)" type="text" class="form-control search-filter" style="width: 100%;" ng-model="listInput" placeholder="{{texts.buttonAllDefaultText}}" focus-on="focusInput"/><span class="add-list-item" ng-class="{disabled: selectedModel.length === listMaxNumOfItems - 1}" ng-click="listItems.add(listInput, $event);">Add</span></li>',l+='<ul class="dropdown-list"><li class="dropdown-list-item" ng-repeat="val in listItems.get()"><a><span ng-click="listItems.remove($index)" class="delete-item-list-btn"></span><span class="list-item-text">{{val}}</span></a></li> </ul>',l+='<li ng-show="settings.groupBy && settings.showModes" class="group-toggle"><a class="toggle-text" ng-class="{toggleTextSelected: selectedGroupKey}" ng-click="setGroupSelectOption(settings.groupKey)">{{settings.groupKey}} Mode</a>',l+='<a class="toggle-text" ng-class="{toggleTextSelected: !selectedGroupKey}" ng-click="setGroupSelectOption(settings.displayProp)">{{settings.displayProp}} Mode</a></li>',l+='<li ng-show="settings.enableSearch" class="dropdown-search-holder"><div class="dropdown-header"><input ng-change="clearSelectedRow()" id="{{elementId}}_search" type="text" class="form-control search-filter" style="width: 100%;" ng-model="searchFilter" placeholder="{{texts.searchPlaceholder}}" focus-on="focusInput"/></li>',l+='<li ng-show="settings.enableSearch" class="divider"></li>',l+='<li ng-show="settings.enableEmpty"></li>',l+='<li ng-if="!settings.list" ng-hide="!settings.showCheckAll || settings.selectionLimit > 0"><a data-ng-click="selectAll(); checkedAll = true" id="{{elementId}}_checkAll"><span ng-class="{\'checkbox-ok\': isCheckedAll()}" class="checkbox"></span>{{texts.checkAll}}</a>',l+='<li ng-show="settings.showUncheckAll" class="uncheckAll-separator"><a data-ng-click="deselectAll(); checkedAll = false" id="{{elementId}}_uncheckAll"><span class="checkbox uncheck-all"></span>{{texts.uncheckAll}}</a></li>',l+='<li ng-if="!settings.list" ng-hide="(!settings.showCheckAll || settings.selectionLimit > 0) && !settings.showUncheckAll" class="divider"></li>',l+='<li class="divider" ng-show="settings.selectionLimit > 1"></li>',l+='<li role="presentation" ng-show="settings.selectionLimit > 1" class="selection-indicator"><a role="menuitem">{{selectedModel.length}} {{texts.selectionOf}} {{settings.selectionLimit}} {{texts.selectionCount}}</a></li>',l+='<li ng-if="groups === true"><ul class="select-option-wrapper">',l+='<li ng-repeat="option in orderedItems | filter: searchFilter" class="multiselector-group-title" ng-class="{\'groupOpenedList\': openGroup}" ng-if="getPropertyForObject(orderedItems[$index], settings.groupBy) !== getPropertyForObject(orderedItems[$index-1], settings.groupBy)">',l+='<a  role="presentation" tabindex="-1" ng-click="groupTitleEvent(getPropertyForObject(option,settings.groupBy), !isCheckedGroup(getPropertyForObject(option,settings.groupBy)))" ng-mouseover="groupHovered=true" ng-mouseout="groupHovered=false">',l+='<span data-ng-class="{\'checkbox-ok\': isCheckedGroup(getPropertyForObject(option,settings.groupBy)), \'checkbox-minus\': isCheckedGroupPart(getPropertyForObject(option,settings.groupBy))}" class="checkbox" ng-click="groupCheckboxEvent(getPropertyForObject(option,settings.groupBy), !isCheckedGroup(getPropertyForObject(option,settings.groupBy)), $event)"></span>',l+=" {{getGroupTitle(getPropertyForObject(option, settings.groupBy)) | limitTo:settings.tooltipNumLimit}}</a> ",l+='<i class="group-arrow" ng-class="{\'arrow-opened\': openGroup}" ng-click="openGroup = !openGroup" ng-show="!selectedGroupKey"></i>',l+='<ul class="group-list"  ng-class="openGroup ? \'group-open\' : \'\'" ng-show="!selectedGroupKey">',l+='<li role="presentation"  ng-repeat="option in options | filter: getPropertyForObject(option,settings.groupBy)"  tooltip-enable="checkDisabled($index)" uib-tooltip="{{option.disabledTooltip}}>',l+='<a id="{{elementId}}_option{{option.id}}" role="menuitem" tabindex="-1" ng-click="!checkDisabled($index) && setSelectedItem(getPropertyForObject(option,settings.idProp))" tooltip="{{getPropertyForObject(option, settings.displayProp)}}"  ng-class="{\'shorten\':(getPropertyForObject(option, settings.displayProp).length > settings.tooltipNumLimit), \'disabled\':checkDisabled($index)}" tooltip-enable="getPropertyForObject(option, settings.displayProp).length > settings.tooltipNumLimit">',l+='<span data-ng-class="{\'checkbox-ok\': isChecked(getPropertyForObject(option,settings.idProp))}" class="checkbox"></span>{{getPropertyForObject(option, settings.displayProp)}}</a>',l+="</li></ul>",l+="</li>",l+="</ul></li>",l+='<li ng-if="groups === false && !list"><ul class="select-option-wrapper">',l+='<li role="presentation" ng-repeat="option in options | filter: searchFilter | limitTo: itemsDisplayedInList track by $index " tooltip-enable="checkDisabled($index)"  uib-tooltip="{{option.disabledTooltip}}" ng-class="{\'dropdown-multiselect-selected\':$index == selectedRow}">',l+='<a id="{{elementId}}_option{{option.id}}" role="menuitem" href="javascript:void(0)" ng-click="!checkDisabled($index) && setSelectedItem(getPropertyForObject(option,settings.idProp))" tooltip="{{getPropertyForObject(option, settings.displayProp)}}" tooltip-enable="checkDisabled($index)" uib-tooltip="{{disabledTooltip}}" ng-class="{ \'shorten\':(getPropertyForObject(option, settings.displayProp).length > settings.tooltipNumLimit), \'disabled\':checkDisabled($index)}" tooltip-enable="getPropertyForObject(option, settings.displayProp).length > settings.tooltipNumLimit">',l+=n?'<div class="checkbox"><label><input class="checkboxInput" type="checkbox" ng-click="checkboxClick($event, getPropertyForObject(option,settings.idProp))" ng-checked="isChecked(getPropertyForObject(option,settings.idProp))" /> {{getPropertyForObject(option, settings.displayProp)}}</label></div></a>':'<span data-ng-class="{\'checkbox-ok\': isChecked(getPropertyForObject(option,settings.idProp))}" class="checkbox"></span> {{getPropertyForObject(option, settings.displayProp) | limitTo:settings.tooltipNumLimit}}</a>',l+="</li>",l+="</ul></li>",l+="</ul>",l+="</div>",e.html(l)},link:function(o,n,s){o.listInput="";var i,r,c,d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];o.elementId=s.id,o.groups=!!s.groupBy,o.selectedRow=-1,o.groupSelectOption;var a=n.children()[0];function p(e){var t={};return""===o.settings.externalIdProp?t[o.settings.idProp]=e:t[o.settings.externalIdProp]=e,t}function u(e){for(var t in e)delete e[t]}o.list&&(o.listItems={add:function(e,t){var n=function(e){if(e){var t=e&&"string"==typeof e.value?e:e.target&&e.target.parentElement?e.target.parentElement.querySelector("input"):null;t&&(t.value="")}};if(o.selectedModel.length!==o.listMaxNumOfItems-1){for(var l=(e=e.replace(/\s\s+/g," ")).split(/\s+/),s=0;s<l.length;s++){if(o.selectedModel.length===o.listMaxNumOfItems-1)return void n(t);l[s].length<=o.listItemMaxChar&&o.selectedModel.push(l[s])}o.selectedModel=o.selectedModel.filter(function(e,t,o){return t===o.indexOf(e)}),n(t)}},remove:function(e){o.selectedModel.splice(e,1)},get:function(){return o.selectedModel}}),o.toggleDropdown=function(){o.open=!o.open,o.open&&l("focusInput")},o.checkboxClick=function(e,t){o.setSelectedItem(t),e.stopImmediatePropagation()},o.submitListVal=function(e){var t=e.currentTarget.value;if(13==e.which)o.listItems.add(t,e.target);else if(46!=e.which&&80!=e.which){var n=t.match(/\S+/g);(n=" "==t.substr(t.length-1)?"":n?n[n.length-1]:"").length>=o.listItemMaxChar&&32!=e.which&&e.preventDefault()}},o.externalEvents={onItemSelect:angular.noop,onItemDeselect:angular.noop,onSelectAll:angular.noop,onDeselectAll:angular.noop,onInitDone:angular.noop,onMaxSelectionReached:angular.noop},o.settings={dynamicTitle:!0,scrollable:!1,scrollableHeight:"300px",closeOnBlur:!0,displayProp:"label",idProp:"id",externalIdProp:"id",enableSearch:!1,selectionLimit:0,showCheckAll:!0,showUncheckAll:!0,closeOnSelect:!1,buttonClasses:"btn btn-default",closeOnDeselect:!1,groupBy:s.groupBy||void 0,showModes:s.showModes||!0,selectedGroup:s.selectedGroup||void 0,groupByTextProvider:null,allowGroupSelect:!0,smartButtonMaxItems:0,smartButtonTextConverter:angular.noop,tooltipNumLimit:o.tooltipNumLimit?o.tooltipNumLimit:30,enableEmpty:!1},o.texts={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"checked",selectionOf:"/",searchPlaceholder:"Search...",buttonDefaultText:"Select",dynamicButtonTextSuffix:"checked",buttonAllDefaultText:null,buttonCustomDateText:null},o.searchFilter=o.searchFilter||"",o.itemsDisplayedInList=20,o.clearSelectedRow=function(e){o.selectedRow=-1},o.openGroup=!1,angular.extend(o.settings,o.extraSettings||[]),angular.extend(o.externalEvents,o.events||[]),angular.extend(o.texts,o.translationTexts),r=o.$watch("translationTexts",function(e){angular.extend(o.texts,e)}),c=o.$watch("extraSettings",function(e){angular.extend(o.settings,e)}),angular.isDefined(o.settings.groupBy)&&(i=o.$watch("options",function(t){angular.isDefined(t)&&(o.orderedItems=e("orderBy")(t,o.settings.groupBy))})),o.api&&void 0!==o.api.selectedGroupKey&&(o.selectedGroupKey=o.api.selectedGroupKey[0]),void 0===o.selectedGroupKey&&(o.selectedGroupKey=!0),o.api&&(o.api.selectedGroupSecondaryStorage||(o.api.selectedGroupSecondaryStorage=[])),o.singleSelection=1===o.settings.selectionLimit,o.singleSelection&&o.selectedModel&&angular.isArray(o.selectedModel)&&0===o.selectedModel.length&&u(o.selectedModel),o.clickHandler=function(e){for(var t=e.target.parentElement,n=!1;angular.isDefined(t)&&null!==t&&!n;)"string"==typeof t.className&&_.contains(t.className.split(" "),"multiselect-parent")&&!n&&t===a&&(n=!0),t=t.parentElement;n||o.$apply(function(){o.open=!1})},o.settings.closeOnBlur&&t.on("click.ngDropdownMultiselect",o.clickHandler),o.getGroupTitle=function(e){return null!==o.settings.groupByTextProvider?o.settings.groupByTextProvider(e):e},o.checkDisabled=function(e){var t=o.options[e]&&o.options[e].dataBinding?o.options[e].dataBinding:o.options[e].id;return!!(o.disabledItems&&o.disabledItems.indexOf(t)>-1)},o.getButtonText=function(e){if(o.list&&o.listItems.get().length){var t=[];return t=o.listItems.get().slice(0,2),(t=_.uniq(t)).push("..."),t.join(", ")}if(o.settings.dynamicTitle&&o.selectedModel&&(o.selectedModel.length>0||angular.isObject(o.selectedModel)&&_.keys(o.selectedModel).length>0)){if(o.settings.smartButtonMaxItems>0){t=[];return o.options&&o.options.length===o.selectedModel.length&&o.texts.buttonAllDefaultText?o.texts.buttonAllDefaultText:o.options&&o.options[o.selectedModel.id]&&"custom"===o.options[o.selectedModel.id].value?o.texts.buttonCustomDateText:(angular.forEach(o.options,function(n){if(o.isChecked(o.getPropertyForObject(n,o.settings.idProp))){if(o.groups&&o.selectedGroupKey)var l=o.getPropertyForObject(n,o.settings.groupBy);else{l=o.getPropertyForObject(n,o.settings.displayProp);if(e&&n.displayDate){var s,i,r=new Date;if("month"===n.startDate?(s=new Date(r.getFullYear(),r.getMonth(),1),i=r):"lastmonth"===n.startDate?(s=new Date((new Date).setDate((new Date).getDate()-n.startDate)),i=new Date((new Date).setDate((new Date).getDate()-n.endDate))):(s=new Date((new Date).setDate((new Date).getDate()-n.startDate)),d[s.getMonth()]+" "+s.getDate()),n.startDate!==n.endDate){i=new Date((new Date).setDate((new Date).getDate()-n.endDate));var c=d[i.getMonth()]+" "+i.getDate();l+=": "+(d[s.getMonth()]+" "+s.getDate())+" - "+c}else l+=": "+(d[s.getMonth()]+" "+s.getDate())}}var a=o.settings.smartButtonTextConverter(l,n);t.push(a||l)}}),o.groups&&o.selectedGroupKey?(t=_.uniq(t)).length>o.settings.smartButtonMaxItems&&(t=t.slice(0,o.settings.smartButtonMaxItems)).push("..."):o.selectedModel.length>o.settings.smartButtonMaxItems&&(t=t.slice(0,o.settings.smartButtonMaxItems)).push("..."),t.join(", "))}var n;return 0===(n=o.singleSelection?null!==o.selectedModel&&angular.isDefined(o.selectedModel[o.settings.idProp])?1:0:angular.isDefined(o.selectedModel)?o.selectedModel.length:0)?o.texts.buttonDefaultText:n+" "+o.texts.dynamicButtonTextSuffix}return o.texts.buttonDefaultText},o.getPropertyForObject=function(e,t){return angular.isDefined(e)&&e.hasOwnProperty(t)?e[t]:""},o.selectAll=function(e){o.deselectAll(!1),o.externalEvents.onSelectAll(),angular.forEach(o.options,function(e){o.setSelectedItem(e[o.settings.idProp],!0,!0)})},o.deselectAll=function(e){(e=e||!0)&&o.externalEvents.onDeselectAll(),o.singleSelection?u(o.selectedModel):o.selectedModel.splice(0,o.selectedModel.length)},o.selectOrdeselectAll=function(e,t){angular.forEach(o.options,function(n){e&&n[o.settings.groupBy]!==e||o.setSelectedItem(n[o.settings.idProp],t)})},o.selectAllInGroup=function(e,t){angular.forEach(o.options,function(t){t[o.settings.groupBy]===e&&o.setSelectedItem(t[o.settings.idProp],!0)})},o.deselectAllInGroup=function(e,t){o.options.forEach(function(t){if(t[o.settings.groupBy]===e){var n=_.findIndex(o.selectedModel,function(e){return e.id===t.id});n>-1&&o.selectedModel.splice(n,1)}})},o.setSelectedItem=function(e,t,n){if(!(o.disabledItems&&o.disabledItems.indexOf(e)>=0)){var l=p(e),s=null;if(s=""===o.settings.externalIdProp?_.find(o.options,l):l,o.singleSelection)return u(o.selectedModel),angular.extend(o.selectedModel,s),o.externalEvents.onItemSelect(s,o.index,o.dependency),void(o.settings.closeOnSelect&&(o.open=!1));t=t||!1;var i=-1!==_.findIndex(o.selectedModel,l);!t&&i?(o.selectedModel.splice(_.findIndex(o.selectedModel,l),1),n||o.externalEvents.onItemDeselect(l)):!i&&(0===o.settings.selectionLimit||o.selectedModel.length<o.settings.selectionLimit)&&(o.selectedModel.push(s),n||o.externalEvents.onItemSelect(s)),o.settings.closeOnSelect&&(o.open=!1)}},o.isChecked=function(e){return o.singleSelection?null!==o.selectedModel&&angular.isDefined(o.selectedModel[o.settings.idProp])&&o.selectedModel[o.settings.idProp]===p(e)[o.settings.idProp]:-1!==_.findIndex(o.selectedModel,p(e))},o.isCheckedAll=function(){var e;return e=o.orderedItems?o.orderedItems.length:o.options?o.options.length:[],o.selectedModel.length===e},o.isCheckedGroup=function(e){if(o.selectedModel.length>=1){var t=0,n=0;return o.orderedItems.forEach(function(n){n[o.settings.groupBy]===e&&t++}),o.selectedModel.forEach(function(t){t[o.settings.groupBy]===e&&n++}),n===t}return!1},o.isCheckedGroupPart=function(e){if(o.selectedModel.length>=1){var t=0,n=0;return o.orderedItems.forEach(function(n){n[o.settings.groupBy]===e&&t++}),o.selectedModel.forEach(function(t){t[o.settings.groupBy]===e&&n++}),n<t&&n>0}return!1},o.setGroupSelectOption=function(e){if(o.groupSelectOption!==e&&(o.groupSelectOption=e,e===o.settings.groupKey?o.selectedGroupKey=!0:e===o.settings.displayProp?o.selectedGroupKey=!1:"toggle"===e&&(o.selectedGroupKey?o.selectedGroupKey=!1:o.selectedGroupKey=!0),o.api&&void 0!==o.api.selectedGroupKey)){o.api.selectedGroupKey=o.selectedGroupKey,o.api.selectedGroupKeyFunction(o.selectedGroupKey);var t=[];t=o.selectedModel.slice(0),o.selectedModel.splice(0,o.selectedModel.length),angular.extend(o.selectedModel,o.selectedTempModel.slice(0)),o.selectedTempModel.splice(0,o.selectedTempModel.length),angular.extend(o.selectedTempModel,t.slice(0))}},o.groupTitleEvent=function(e,t){o.selectedGroupKey?o.selectOrdeselectAll(e,t):this.openGroup=!this.openGroup},o.groupCheckboxEvent=function(e,t,n){o.selectedGroupKey||(o.selectOrdeselectAll(e,t),this.openGroup?this.openGroup=!0:this.openGroup=!1,n.stopPropagation())},o.api&&(o.api.toggleDropdown=function(){o.toggleDropdown()}),o.addMoreItems=function(){o.itemsDisplayedInList+=1},o.getInfiniteScrollContainer=function(){return"#"+o.elementId+"-multiselect-wrapper"},o.clickedRow=function(e){o.options.forEach(function(t){o.getPropertyForObject(t,o.settings.displayProp)===e&&o.setSelectedItem(t.id)})},void 0!==o.settings.selectedGroup&&o.setGroupSelectOption(o.settings.selectedGroup),o.$on("$destroy",function(){a=null,t.off("click.ngDropdownMultiselect",o.clickHandler),i&&i(),r&&r(),c&&c()}),o.externalEvents.onInitDone()}}}]),directiveModule.directive("arrowSelector",["$document",function(e){return{restrict:"A",link:function(t,o,n,l){var s=!1;t.mouseenterHandler=function(){s=!0},t.mouseleaveHandler=function(){s=!1,t.selectedRow=-1},t.keydownHandler=function(e){if(s)if(38==e.keyCode){if(0==t.selectedRow)return;t.selectedRow--,t.$apply(),e.preventDefault()}else if(40==e.keyCode){if(t.selectedRow==t.options.length-1)return;t.selectedRow++,t.$apply(),e.preventDefault()}else if(13==e.keyCode&&t.selectedRow>-1){var n=o.find("li.dropdown-multiselect-selected").children("a").attr("tooltip");t.clickedRow(n),t.$apply(),e.preventDefault()}},o.on("mouseenter.ngDropdownMultiselect",t.mouseenterHandler),o.on("mouseleave.ngDropdownMultiselect",t.mouseleaveHandler),e.bind("keydown.ngDropdownMultiselect",t.keydownHandler),t.$on("$destroy",function(){o.off("mouseenter.ngDropdownMultiselect",t.mouseenterHandler),o.off("mouseleave.ngDropdownMultiselect",t.mouseleaveHandler),e.off("keydown.ngDropdownMultiselect",t.keydownHandler)})}}}]);
